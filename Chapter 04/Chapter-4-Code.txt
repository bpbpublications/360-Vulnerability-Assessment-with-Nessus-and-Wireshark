Enable routing IPv4 and IPv6 in Linux System:
echo “net.ipv4.ip_forward = 1” >> /etc/sysctl.conf
echo “net.ipv6.conf.all.forwarding = 1” >> /etc/sysctl.conf
sysctl -p

-------------------------------------------------------------

Configuring Interfaces Iin GNU-Linux Debian system:
#### Interfaces #####
## eth0 – Local Area Network
## eth1 – Wide Area Network
auto eth0
iface eth0 inet manual

auto eth0.10
iface eth0.10 inet static
address 172.16.0.1
netmask 255.255.255.0

auto eth0.20
iface eth0.20 inet static
address 10.25.0.1
netmask 255.255.0.0

auto eth0.30
iface eth0.30 inet static
address 192.168.0.129
netmask 255.255.255.128

auto eth0.5
iface ens37.5 inet static
address 192.168.0.1
netmask 255.255.255.128

auto eth1
iface eth1 inet dhcp

---------------------------------------------------

Close all forward Iptables Connections:
iptables –t filter –A FORWARD –s 0.0.0.0/0 –d 0.0.0.0/0 –j DROP

Allowing networks 10.25.0.0/16 and 172.16.0.0/24 through firewall
iptables -t filter -I FORWARD -d 10.25.0.0/16 -s 172.16.0.0/24 -j ACCEPT
iptables -t filter -I FORWARD -s 172.16.0.0/24 - d 10.25.0.0/16 -j ACCEPT

Masquerade connections/Nat connections
iptables -t nat -A POSTROUTING -s 0.0.0.0/0 -o <WAN_Interface_or_IP_WAN-ADDRESS> -j MASQUERADE

Show configure iptable lines
iptables –nL –t <table>

----------------------------------------------------

Installing squid in Debian Linux system

apt-get install squid

squid.conf configuration:

#Start of squid.conf file

http_port 3128
visible_hostname Proxy-BpB-Course

hierarchy_stoplist CGI-bin ? 
error_directory /usr/share/squid/errors/English 
cache_mgr admin@dominioadm.com.br 
acl QUERY urlpath_regex cgi-bin ?
no_cache deny QUERY 

cache_mem 64 MB 
maximum_object_size_in_memory 64 KB 
maximum_object_size 512 MB
minimum_object_size 0 KB 
cache_swap_low 90
cache_swap_high 95 
cache_dir ufs /var/spool/squid 2048 16 256
cache_access_log /var/log/squid/access.log 
refresh_pattern ^ftp: 15 20% 2280
refresh_pattern ^gopher: 15 0% 2280
refresh_pattern . 15 20% 2280

acl all src 0.0.0.0/0.0.0.0
acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255
acl SSL_ports port 443 563
acl Safe_ports port 21 80 443 563 70 210 280 488 59 777 901 1025-65535
acl purge method PURGE
acl CONNECT method CONNECT 

http_access allow manager localhost
http_access deny manager
http_access allow purge localhost
http_access deny purge
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports 

acl redelocal src 172.16.0.0/24 

http_access allow localhost
http_access allow redelocal
http_access deny all

#End of squid.conf file

Create squid swap directories: squid -z

Start squid service:
systemctl start squid.service

Redirecting ports to squid:
iptables -t nat -A PREROUTING -s LOCAL_NETWORK/SUBNET_MASK -p tcp --dport <Port_number> -j REDIRECT --to-port 3128

Adding squid.conf line to make it transparent and work with ssl:
http_port 3128 transparent
https_port 443 intercept
ssl-bump cert=/etc/squid/ssl/ca/intermediate/certs/wilcard.pem key=/etc/squid3/ssl/ca/intermediate/private/wildcard.key generate-host-certificates=off version=4 options=NO_SSLv2,NO_SSLv3,SINGLE_DH_USE
sslcrtd_program /usr/libexec/ssl_crtd -s /var/log/squid/ssl_db -M 4MB sslcrtd_children 1 startup=1 idle=1
ssl_bump bump HTTPS
ssl_bump splice all


Installing snort:
apt-get install snort

Configuring interface to work in promiscuos mode:
ip link set <interface_ID> promisc on

Starting Snort:
snort -d -l /var/log/snort/ -h <network/netmask> -A console -c /etc/snort/snort.conf